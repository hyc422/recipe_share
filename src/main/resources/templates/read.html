<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>게시글 상세</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
<title>Insert title here</title>
</head>
<body>
<!-- #1CGH -->
<div th:replace="top :: myIncludedFragment"></div>
	<hr> <!-- 탑과 사이드를 구분하기 위해 추가 -->
	<div> <!-- 탑과 사이드를 같은 줄에 배치하기 위해 추가 -->
		<div style="flex-basis: 18%; min-width: 200px;">
			<div th:replace="side :: myIncludedFragment"></div>
		</div>
        <!-- Page content-->
        <div class="container mt-5">
            <div class="row"  style="margin-top: 112px; width: 100%;">
                <div class="col-lg-8">
                    <!-- Post content-->
                    <article>
                        <!-- Post header-->
                        <header class="mb-4">
                            <!-- Post title-->
                            <h1 class="fw-bolder mb-1">제목!!!!</h1>
                            <!-- Post meta content-->
                            <div class="text-muted fst-italic mb-2">등록날짜!!!</div>
                            <!-- Post categories-->
                            <a class="badge bg-secondary text-decoration-none link-light">카테고리</a>
                            <a class="badge bg-secondary text-decoration-none link-light">닉네임</a>
                        </header>
                        <!-- Post content-->
                        <section class="mb-5">
                            <p class="fs-5 mb-4">게시글 내용 등록</p>
                        </section>
                        <!-- Preview image figure-->
                        <figure class="mb-4"><img class="img-fluid rounded" src="https://dummyimage.com/900x400/ced4da/6c757d.jpg" alt="게시글 사진 출력" /></figure>
                    </article>
                    <!-- Comments section-->
                    <section class="mb-5">
                        <div class="card bg-light">
                            <div class="card-body">
                                <!-- Comment form-->
                                <form class="mb-4">
                                <textarea class="form-control" rows="3" placeholder="댓글을 써보아요~">
                                </textarea>
                                <button type="button" class="btn btn-secondary" style="margin-top: 10px;">등록</button>
                                </form>
                                <!-- Single comment-->
                                <div class="d-flex">
                                    <div class="flex-shrink-0"></div>
                                    <div class="ms-3">
                                        <div class="fw-bold">닉네임(등록날짜)</div>
                                        댓글 내용
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                </div>
            </div>
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- #1CGH -->
	<h3>레시피 커뮤니티</h3>
	<hr>
	<ul>
	<li>
				<ul class="rowme">   <!-- 부트스트랩과 id이름 충돌하여 변경  -->
					<li>제목</li>
					<li th:text="${vo.title}"></li>
					<li>조회수</li>
					<li th:text="${vo.viewcnt}"></li>
				</ul>
			</li>
			<li>
				<ul class="rowme">
					<li>작성자</li>
					<li>[[${vo.nickname}]]
					<span style="font-size: 70%; padding-left: 30px;" th:text="(${vo.nickname})"></span></li>
					<li>작성날짜</li>
					<li th:text="${#temporals.format(vo.regdate,'yyyy-MM-dd HH:mm')}"></li>
				</ul>
			</li>
			<li id="content">
				<ul>
					<li>내용</li>			
					<!-- textarea에 입력한 엔터는 \n db에도 \n으로 저장됩니다.
					     브라우저 출력은 줄바꿈은 <br> 태그 해결1) pre 태그, 해결  2) \n을 <br>로 대치-->	
					<li>
						<pre th:text="${vo.content}"></pre>
					</li>				
				</ul>
			</li>
	</ul>
	<div style="text-align: center;margin-bottom: 10px;">
	<!-- <span th:if="${session.member}!=null and ${session.member.id}==${vo.writer}"> -->
	 <!-- session 에 저장된 user애트리뷰트의 id와 작성자의 id 가 같은면 보이기 -->
		<a class="button" th:href="|javascript:execute(1,'${vo.idx}','${Cate}',${a})|">수정</a>  
		<!-- 자바스크립트 함수:인자값 1은 수정, 게시물 번호, 카테고리, 페이지 번호 전달 -->
		<a class="button" th:href="|javascript:execute(2,'${vo.idx}','${Cate}',${a})|">삭제</a>  
		<!-- 자바스크립트 함수:인자값 2는 삭제, 게시물 번호, 카테고리, 페이지 번호 전달 -->
	<!-- </span> -->
		<a class="button" th:href="@{list(Cate=${Cate },a=${a},page=${page})}">목록</a>   <!-- 현재페이지 번호 전달 - 순서3) -->
	</div>
	<script type="text/javascript" th:inline="javascript">
		function execute(f, idx, cate, a){
			let url
			let message
			if(f===1){
				message='글 수정하시겠습니까?'
				url = 'update?idx='+idx+'&Category='+cate+'&a='+a+'&page=1'
			}else if(f===2){
				message='글 삭제하시겠습니까?'
				url = 'delete?idx='+idx+'&Category='+cate+'&a='+a+'&page=1'
			}
			const yn = confirm(message)
			if(yn) {
				location.href=url;
			}else{
				alert('취소합니다.')
			}	
		}
	</script>

	<hr>
	<form method="post" th:action="@{/read}" th:object="${com}">
    <input type="hidden" th:name="merf" th:value="${vo.idx}">
    <input type="hidden" th:name="cate" th:value="${vo.Category}" />
    <input type="hidden" th:name="a" th:value="${a}" />
    <input type="hidden" th:name="page" th:value="${page}" />
    <p>
        <label>댓글 작성자</label> <input type="text" th:name="nickname" />
    </p>
    <p>
        <label for="contents">댓글 내용</label>
        <textarea rows="5" cols="50" th:name="contents" id="contents"></textarea>
    </p>
    <p>
        <button type="submit" name="${cnt.merf}" onclick="execute(event, this.form)">댓글 작성</button>
    </p>
    
</form>
<div>
    <ul>
        <li>댓글 수 : <span th:text="${vo.numcomments}">0</span></li>
    </ul>
</div>
    <div th:each="cmt : ${cmtlist}">
  <ul class="crow">
    <li th:text="${cmt.nickname}"></li>
    <li th:text="${#temporals.format(vo.regdate,'yyyy-MM-dd HH:mm')}"></li>
<!--     <li th:if="${session.member != null and session.member.id == cmt.writer}">
      <a href="javascript:executeCmt('2', ${cmt.idx})">삭제</a> -->
  <!--   </li> -->
    <li th:text="${cmt.contents}">
    </li>
  </ul>
</div>
<script type="text/javascript">
function execute(event) {
	event.preventDefault(); // 기본 이벤트 중지
	 console.log(event); // event 객체 출력

	    const contents = document.querySelector("#contents").value; // textarea 내용 가져오기
	    const form = event.target.form; // 폼 요소 가져오기

	    // FormData 객체 생성
	    const formData = new FormData(form);
	    formData.append("contents", contents);

	    // Ajax를 사용하여 댓글 작성 처리
	    const xhr = new XMLHttpRequest();
	    xhr.open(form.method, form.action);
	    xhr.send(formData);
</script>
</body>
</html>